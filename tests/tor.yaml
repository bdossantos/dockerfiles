schemaVersion: '2.0.0'

fileExistenceTests:
  - name: 'tor binary exists'
    path: '/usr/local/bin/tor'
    shouldExist: true
    permissions: '-rwxr-xr-x'
    uid: 0
    gid: 0

  - name: 'torrc.sample exists'
    path: '/usr/local/etc/tor/torrc.sample'
    shouldExist: true
    uid: 0
    gid: 0

  - name: 'torrc exists'
    path: '/etc/tor/torrc'
    shouldExist: true
    permissions: '-r--r--r--'
    uid: 0
    gid: 0

commandTests:
  - name: 'tor binary checksum'
    command: 'sha256sum'
    args: ['/usr/local/bin/tor']
    expectedOutput:
      - '68ebbf2cf786cc35dde18f50fc164963fa0b1d2a1e8b7a883eb3aeafa382cf09'

  - name: 'torrc.sample checksum'
    command: 'sha256sum'
    args: ['/usr/local/etc/tor/torrc.sample']
    expectedOutput:
      - '700eab901377ef4834e12a4e16367a0f27f20ecfb546744741ae0ab40f6067a0'

  - name: 'torrc checksum'
    command: 'sha256sum'
    args: ['/etc/tor/torrc']
    expectedOutput:
      - 'd869589e8c7c49972c445f40a7f14c2c6b32ad17055160052ce75fa79c95349e'

  - name: 'tor version check'
    command: '/usr/local/bin/tor'
    args: ['--version']
    exitCode: 0
    expectedOutput:
      - 'Tor version 0.4.4.6.'

  - name: 'ca-certificates package is installed'
    command: 'dpkg'
    args: ['-s', 'ca-certificates']
    exitCode: 0

  - name: 'openssl package is installed'
    command: 'dpkg'
    args: ['-s', 'openssl']
    exitCode: 0

  - name: 'wget package is installed'
    command: 'dpkg'
    args: ['-s', 'wget']
    exitCode: 0

  - name: 'zlib1g package is installed'
    command: 'dpkg'
    args: ['-s', 'zlib1g']
    exitCode: 0

fileContentTests:
  - name: 'torrc has correct configuration'
    path: '/etc/tor/torrc'
    expectedContents:
      - 'AutomapHostsOnResolve 1'
      - 'AutomapHostsSuffixes .exit,.onion'
      - 'AvoidDiskWrites 1'
      - 'ClientOnly 1'
      - 'DNSPort 0.0.0.0:9053'
      - 'DataDirectory /dev/shm/.tor'
      - 'ExcludeNodes \{au\},\{ca\},\{cn\},\{cu\},\{fr\},\{gb\},\{hk\},\{ir\},\{iq\},\{kr\},\{kp\},\{nz\},\{ro\},\{ru\},\{sy\},\{tr\},\{us\}'
      - 'ExitNodes \{be\},\{ch\},\{de\},\{es\},\{gr\},\{is\},\{it\},\{nl\},\{se\},\{no\},\{fi\},\{es\},\{pt\}'
      - 'FascistFirewall 1'
      - 'Log notice stdout'
      - 'NumCPUs 2'
      - 'ReachableAddresses \*:80,\*:443'
      - 'RunAsDaemon 0'
      - 'SafeLogging 1'
      - 'SocksPort 0.0.0.0:9050'
      - 'StrictNodes 1'
