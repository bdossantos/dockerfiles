schemaVersion: '2.0.0'

fileExistenceTests:
  - name: 'radicale binary exists'
    path: '/app/bin/radicale'
    shouldExist: true
    permissions: '-rwxr-xr-x'
    uid: 0
    gid: 0

  - name: 'radicale config file exists'
    path: '/config/radicale.cfg'
    shouldExist: true
    uid: 65534
    gid: 65534

commandTests:
  - name: 'radicale binary checksum'
    command: 'sha256sum'
    args: ['/app/bin/radicale']
    expectedOutput:
      - '2456d1e5f6d23920b487c28e366b68addb1ab07b2fad9f44d27779709dacba5b'

  - name: 'radicale config checksum'
    command: 'sha256sum'
    args: ['/config/radicale.cfg']
    expectedOutput:
      - '766bb94b045bd5f172170046c976f0b30e2e2b997eecf0a817cbdf303ac9102c'

fileContentTests:
  - name: 'radicale config has correct settings'
    path: '/config/radicale.cfg'
    expectedContents:
      - 'hosts = 0.0.0.0:5232, \[::\]:5232'
      - 'max_connections = 20'
      - 'max_content_length = 100000000'
      - 'timeout = 60'
      - 'type = htpasswd'
      - 'htpasswd_filename = /config/users'
      - 'htpasswd_encryption = bcrypt'
      - 'delay = 1'
      - 'type = owner_only'
      - 'type = multifilesystem'
      - 'filesystem_folder = /data/collections'
      - 'mask_passwords = True'
