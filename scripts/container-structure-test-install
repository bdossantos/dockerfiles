#!/usr/bin/env bash

set -euo pipefail

readonly VERSION="v1.19.1"
readonly BINARY_NAME="container-structure-test-linux-amd64"
INSTALL_DIR="$(pwd)/bin"
readonly INSTALL_DIR
readonly BINARY_PATH="${INSTALL_DIR}/container-structure-test"

mkdir -p "${INSTALL_DIR}"

if [[ -f "${BINARY_PATH}" ]]; then
  echo "container-structure-test already installed at ${BINARY_PATH}"
  exit 0
fi

echo "Downloading container-structure-test ${VERSION}..."
curl -LO "https://github.com/GoogleContainerTools/container-structure-test/releases/download/${VERSION}/${BINARY_NAME}"

chmod +x "${BINARY_NAME}"
mv "${BINARY_NAME}" "${BINARY_PATH}"

echo "container-structure-test installed successfully at ${BINARY_PATH}"
"${BINARY_PATH}" version
